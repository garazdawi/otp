## %CopyrightBegin%
##
## SPDX-License-Identifier: Apache-2.0
##
## Copyright Ericsson AB 2025. All Rights Reserved.
##
## Licensed under the Apache License, Version 2.0 (the "License");
## you may not use this file except in compliance with the License.
## You may obtain a copy of the License at
##
##     http://www.apache.org/licenses/LICENSE-2.0
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
##
## %CopyrightEnd%

name: Update vendored dependencies

on:
  pull_request:
    paths:
      - '**/vendor.info'

permissions:
  contents: write   # Required to push commits
  issues: write     # Required to create issues
  pull-requests: read

jobs:
  update-vendored-deps:
    runs-on: ubuntu-latest
    if: contains(github.event.pull_request.title, 'Update dependency') && github.actor == 'renovate[bot]'
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Git user
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
      - name: Find and process modified vendor.info files
        id: update-deps
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: .github/scripts/update-vendored-deps.sh '${{ github.event.pull_request.base.sha }}' '${{ github.event.pull_request.head.sha }}'
          